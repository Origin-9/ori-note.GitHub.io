**序列化机制允许将实现序列化的Java对象转换一定的数据格式，然后可以保存在磁盘上，或通过网络传输，以达到以后恢复成原来的对象。**

### JDK序列化实现方式

#### 一

##### 被序列化对象要实现Serializable接口，加上serialVersionUID 版本号

> **反序列化必须拥有class文件，但随着项目的升级，class文件也会升级（类文件被修改），**如果反序列化使用的**class的版本号**与序列化时使用的**不一致**，反序列化会**报InvalidClassException异常。**
>
> **序列化版本号可自由指定，如果不指定，JVM会根据类信息自己计算一个版本号(不建议，**不利于jvm间的移植，可能class文件没有更改，但不同jvm可能计算的规则不一样，这样也会导致无法反序列化。)

什么情况下需要修改serialVersionUID呢？分三种情况。

- 如果只是修改了方法，反序列化不容影响，则无需修改版本号；
- 如果只是修改了静态变量，瞬态变量（transient修饰的变量），反序列化不受影响，无需修改版本号；
- 如果修改了非瞬态变量，则可能导致反序列化失败。**如果新类中实例变量的类型与序列化时类的类型不一致，则会反序列化失败，这时候需要更改serialVersionUID。**如果只是新增了实例变量，则反序列化回来新增的是默认值；如果减少了实例变量，反序列化时会忽略掉减少的实例变量。

##### 序列化步骤：

- **步骤一：创建一个ObjectOutputStream输出流；**
- **步骤二：调用ObjectOutputStream对象的writeObject输出可序列化对象。**

##### 反序列化步骤：

- **步骤一：创建一个ObjectInputStream输入流；**
- **步骤二：调用ObjectInputStream对象的readObject()得到序列化的对象。**

##### 注意事项：

1. 类的成员也必须是可序列化的
2. **同一对象序列化多次**，不会**将这个对象序列化多次**

**Java序列化算法**

- **所有保存到磁盘的对象都有一个序列化编码号**

- **当程序试图序列化一个对象时，会先检查此对象是否已经序列化过，只有此对象从未（在此虚拟机）被序列化过，才会将此对象序列化为字节序列输出。**
- **如果此对象已经序列化过，则直接输出编号即可。**

导致一个问题：可变对象再次序列化后，对象属性还是第一次序列化的属性

3. **使用transient关键字选择不需要序列化的字段。**被transient修饰的属性是默认值

#### 二

#### Externalizable：强制自定义序列化

通过实现Externalizable接口，必须实现writeExternal、readExternal方法。

![image-20200815115448015](C:\Users\Ori\AppData\Roaming\Typora\typora-user-images\image-20200815115448015.png)



### Protostuff 实现序列化

基于protobuf发展而来的，protobuf需要编写.proto文件，再把它编译成目标语言

protostuff直接对POJO进行序列化和反序列化，使用起来非常简单

![image-20200815121616401](C:\Users\Ori\AppData\Roaming\Typora\typora-user-images\image-20200815121616401.png)

##### 序列化步骤：

1. 获取需要序列化的对象

2. 使用 protostuff 提供的 LinkedBuffer 分配一块默认大小的连续 buffer 空间
3. 通过对象类构建schema（getSchema(Class clazz)）
4. 将对象序列化为字节数组并返回  （ProtostuffIOUtil.toByteArray(obj,schema,buffer)）

##### 反序列化步骤：

1. 实例化一个类的对象。
2. 通过对象的类构建对应的schema。
3. 使用给定的schema将byte数组和对象合并。

![image-20200815121955943](C:\Users\Ori\AppData\Roaming\Typora\typora-user-images\image-20200815121955943.png)

### 序列化为JSON格式

#### FastJson

支持将Java Bean序列化为JSON字符串，也可以从JSON字符串反序列化到JavaBean。

![image-20200815150607460](C:\Users\Ori\AppData\Roaming\Typora\typora-user-images\image-20200815150607460.png)

```java
public class Q328 {
    class Solution {
        public ListNode oddEvenList(ListNode head) {
            if (head == null || head.next == null)
                return head;

            //奇结点
            ListNode listNode1 = head;
            //偶数节点头
            ListNode listNode2 = head.next;
            //偶数节点尾
            ListNode listNode3 = head.next;
            while (listNode1.next != null && listNode3.next != null) {
                listNode1.next = listNode3.next;
                listNode1 = listNode1.next;

                listNode3.next = listNode1.next;
                listNode3 = listNode3.next;
            }
            listNode1.next = listNode2;
            return head;
        }
    }

    class ListNode {
        int val;
        ListNode next;

        ListNode() {
        }

        ListNode(int val) {
            this.val = val;
        }

        ListNode(int val, ListNode next) {
            this.val = val;
            this.next = next;
        }
    }
}
```