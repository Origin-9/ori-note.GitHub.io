#### 什么是负载均衡

负载均衡是分布式架构中不可忽视的内容，适宜的负载均衡方案能保证服务的高可用。

负载均衡本质就是通过合理的算法将请求均匀分摊到各个服务节点。

##### 负载均衡算法

###### 1. 轮询

轮询算法把每个请求轮流发送到每个服务器上。

该算法比较适合每个服务器的性能差不多的场景

###### 2. 加权轮询

加权轮询是在轮询的基础上，根据服务器的性能差异，为服务器赋予一定的权值，性能高的服务器分配更高的权值。

###### 3. 最少连接

最少连接算法就是将请求发送给当前最少连接数的服务器上。

###### 4. 加权最小连接

根据服务器负载和权重来综合调度

1） 假设各台 RS 的权值依次为 wi,当前连接数依次为 ci,依次计算 ci/wi,值最小的 RS 作为下一个分配的 RS

2） 如果存在ci/wi相同的 RS，这些 RS 再使用加权轮询的方式调度

###### 5. 随机算法

把请求随机发送到服务器上

###### 6. 加权随机

权重越大，随机到的几率越大

###### 7. 一致性Hash负载均衡算法

传统：

服务节点的IP或者其他信息来生成该服务节点的唯一hash值，并将这个 hash 投射到 [0, 2^32 - 1] 的圆环上。

通过对客户端 IP 计算哈希值之后，顺时针寻找最接近该请求方hash值的服务节点

**可以保证同一 IP 的客户端的请求会转发到同一台服务器上。**

**问题：不平衡，可能某一个服务节点负责的请求特别多**

要解决这种问题就需要引入虚拟节点。虚拟节点非常多（例如一个服务节点有1000个虚拟节点），计算虚拟节点Hash值然后让虚拟机点去环上，最后由路由表决定各自虚拟节点的真实服务节点。

##### 服务器端负载均衡

![68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f254537254231254242254536253936253837254534254242254236254535254144253937254538253841253832254537254130](C:\Users\Ori\Desktop\68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f254537254231254242254536253936253837254534254242254236254535254144253937254538253841253832254537254130.png)客户端和服务端之间有一负载均衡器，当请求到负载均衡器后，负载均衡器会通过负载均衡算法将请求转发到对应的服务节点。

###### 优点：

对业务开发没有侵略性，无论负载均衡器如何变化，都不会影响到业务代码

###### 缺点：

- 负载均衡器是整个系统处理的瓶颈，会出现过载，或者单点问题
- 请求要经过负载均衡器代理或者转发，降低传输效率

##### 客户端负载均衡

客户端负载均衡就是把服务列表维护在客户端一侧，由客户端负载均衡算法进行服务器节点的选择

###### 优点：

无需部署负载均衡器，请求不用转发和代理，提高了传输效率，同时不会出现负载均衡器的单点问题

###### 缺点：

对应用客户端开发具有侵略性。



